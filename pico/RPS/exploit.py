#!/usr/bin/env python3

from pwn import *

# context.binary = "./exploit.py"

if args.DEBUG:
    context.log_level = 'DEBUG'

if args.REMOTE:
    p = remote("saturn.picoctf.net",54541)
else:
    p = process()

context.gdb_binary = "pwndbg"
if args.TMUX:
    context.terminal = ['tmux', 'split-pane', '-h']
if args.GDB and not args.REMOTE:
    gdb.attach(p)

hands = ["rock", "paper", "scissors"];
loses = ["paper", "scissors", "rock"];

def get_sel():
    proc = subprocess.Popen("./get_seed")
    return proc.wait()

def winning_sel():
    sel = get_sel()
    return loses[sel]


def play():
    p.recvuntil(b"program")
    p.sendline(b"1")
    win = winning_sel()
    p.recvuntil(b"scissors):")
    p.sendline(win.encode())

def endgame():
    p.recvuntil(b"program")
    p.sendline(b"2")

for _ in range(5):
    play()

endgame()

p.interactive()
